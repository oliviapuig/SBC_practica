# # SBC - Pràctica CBR
# 
# - Aina Gomila
# - Ruth Parajó
# - Olivia Puig
# - Marc Ucelayeta

import pandas as pd
import numpy as np

# Suposem que ja has inicialitzat la instància de la classe CBR amb les dades necessàries

# Exemple de dades d'entrada de l'usuari
user_data = {
    "user_id": "user1",
    "llibres_usuari": [1, 2, 3],  # IDs dels llibres llegits per l'usuari
    "val_llibres": [4, 5, 3]  # Puntuacions donades pels llibres llegits per l'usuari
}

# Creem una instància de l'usuari amb les dades d'entrada
user_instance = pd.DataFrame(user_data, index=[0])

# Inicialitzem l'usuari a la base de dades
cbr_instance = CBR(cases=pd.DataFrame(), clustering=None, books=None)
user_database = cbr_instance.inicia("fitxer_usuaris.txt")

# Afegim l'usuari d'entrada a la base de dades de casos
user_database = pd.concat([user_database, user_instance], ignore_index=True)

# Assignem a l'objecte CBR la nova base de dades amb l'usuari
cbr_instance.cases = user_database

# Simulem la fase de recomanació per a l'usuari
user_result = cbr_instance.recomana(user_instance.iloc[0])

# Imprimim els resultats
print("Llibres recomanats:", user_result["llibres_recomanats"])
print("Puntuacions dels llibres recomanats:", user_result["puntuacions_llibres"])
print("Justificació de les recomanacions:")
cbr_instance.justifica(user_result, cbr_instance.retrieve(user_instance.iloc[0]), cbr_instance.reuse(user_instance.iloc[0], cbr_instance.retrieve(user_instance.iloc[0])))

# Simulem la fase de revisió amb totes les combinacions possibles
combinacions_llibre = ["semblants", "explorar"]
combinacions_popularitat = ["bestseller", "no tan popular"]

for llibre_comb in combinacions_llibre:
    for popularitat_comb in combinacions_popularitat:
        print("\nSimulant fase de revisió amb les següents preferències:")
        print(f"Tipus de llibres: {llibre_comb}")
        print(f"Popularitat: {popularitat_comb}\n")

        # Simulem la fase de revisió
        user_result = cbr_instance.revise(user_result, user_result["llibres_recomanats"])

        # Imprimim els resultats de la revisió
        print("Llibres recomanats després de revisar:", user_result["llibres_recomanats"])
        print("Puntuacions després de revisar:", user_result["puntuacions_llibres"])

